{"version":3,"file":"zwc-chart-bar.cjs","sources":["../../../../../../src/components/zwc-chart-bar/zwc-chart-bar.ts"],"sourcesContent":["import { customElement, property } from 'lit/decorators.js';\r\n\r\nimport type {\r\n  ChartComponentLike,\r\n  ChartData,\r\n  ChartOptions,\r\n  DefaultDataPoint,\r\n  Plugin,\r\n} from 'chart.js';\r\n\r\nimport {\r\n  Chart,\r\n  Colors,\r\n  BarController,\r\n  CategoryScale,\r\n  LinearScale,\r\n  BarElement,\r\n  Legend,\r\n  Tooltip,\r\n  Title,\r\n  SubTitle,\r\n} from 'chart.js';\r\n\r\nimport { ZwcBaseChart } from '../zwc-chart-base';\r\nimport { PropertyValues } from 'lit';\r\nimport { isSameData } from '../../utils';\r\n\r\nexport type TBar = 'bar';\r\n\r\n@customElement('zwc-chart-bar')\r\nexport class ZwcChartBar extends ZwcBaseChart {\r\n  componentsToRegister: ChartComponentLike[] = [\r\n    Colors as ChartComponentLike,\r\n    BarController,\r\n    BarElement,\r\n    CategoryScale,\r\n    LinearScale,\r\n    Legend,\r\n    Tooltip,\r\n    Title,\r\n    SubTitle,\r\n  ];\r\n\r\n  type: TBar = 'bar';\r\n\r\n  // Default Bar Chart options.\r\n  defaultOptions: ChartOptions<TBar> = {\r\n    animation: {\r\n      duration: 2000,\r\n    },\r\n    plugins: {\r\n      legendMargin: {\r\n        margin: 20,\r\n      },\r\n      legend: {\r\n        position: 'top',\r\n        align: 'start',\r\n        labels: {\r\n          usePointStyle: true,\r\n        },\r\n      },\r\n      tooltip: {\r\n        mode: 'point',\r\n        intersect: false,\r\n        // spriteText: use white background to hide any gaps between fonts\r\n        backgroundColor: '#edeef0',\r\n        titleColor: 'black',\r\n        titleAlign: 'center',\r\n        bodyColor: 'black',\r\n        bodyAlign: 'center',\r\n        footerColor: 'black',\r\n        footerAlign: 'center',\r\n        position: 'nearest',\r\n        xAlign: 'center',\r\n        yAlign: 'bottom',\r\n      },\r\n    },\r\n    layout: {\r\n      padding: {\r\n        top: 20,\r\n        left: 20,\r\n        right: 20,\r\n        bottom: 20,\r\n      },\r\n    },\r\n    elements: {\r\n      bar: {\r\n        backgroundColor: ['#0f67c0'],\r\n        borderRadius: Number.MAX_VALUE,\r\n        borderSkipped: false,\r\n      },\r\n    },\r\n    scales: {\r\n      x: {\r\n        ticks: {\r\n          display: true,\r\n        },\r\n        border: {\r\n          color: '#929a9c',\r\n          width: 1,\r\n        },\r\n        grid: {\r\n          display: false,\r\n        },\r\n      },\r\n      y: {\r\n        ticks: {\r\n          display: true,\r\n        },\r\n        grid: {\r\n          color: '#f7f8f7',\r\n          drawTicks: false,\r\n          lineWidth: 2,\r\n        },\r\n        border: {\r\n          display: false,\r\n        },\r\n      },\r\n    },\r\n  };\r\n\r\n  @property()\r\n  plugins: Plugin<TBar>[] = [];\r\n\r\n  @property({ type: Object })\r\n  options: ChartOptions<TBar> = {};\r\n\r\n  @property({\r\n    type: Object,\r\n    hasChanged: (value?: ChartData<TBar>, oldValue?: ChartData<TBar>) => {\r\n      return !isSameData(value, oldValue);\r\n    },\r\n  })\r\n  data: ChartData<TBar> = {\r\n    labels: [2010, 2011, 2012],\r\n    datasets: [\r\n      {\r\n        label: 'Sample chart',\r\n        data: [15, 20, null],\r\n        maxBarThickness: 32,\r\n      },\r\n    ],\r\n  };\r\n\r\n  updated(changed: PropertyValues<this>): void {\r\n    if (changed.has('data') && changed.get('data')) {\r\n      if (this.chart) {\r\n        const { labels, dataSetsDiff } = this.handleDataChange(\r\n          this.chart,\r\n          this.data,\r\n        );\r\n\r\n        if (labels) this.chart?.data.labels?.push(...labels);\r\n\r\n        this.chart?.data.datasets.forEach((dataset, index) => {\r\n          if (dataSetsDiff[index]) {\r\n            dataset.data.push(...dataSetsDiff[index]);\r\n          }\r\n        });\r\n\r\n        this.chart.update('normal');\r\n      }\r\n    }\r\n  }\r\n\r\n  handleDataChange(chart: Chart, newData: ChartData<TBar>) {\r\n    const index = chart.data.labels?.length ?? 0;\r\n    const direction = newData.labels?.length\r\n      ? newData.labels.length - index\r\n      : 0 - index;\r\n\r\n    let labels: unknown[] = [];\r\n    let dataSetsDiff: DefaultDataPoint<TBar>[] = [];\r\n\r\n    if (direction === 0) {\r\n      // TODO check with datasets length;\r\n    } else if (direction > 0) {\r\n      // adding data\r\n      labels = newData.labels ? newData.labels.slice(index ?? 0) : [];\r\n      const dataPoints = labels.length;\r\n\r\n      dataSetsDiff = newData.datasets.map(dataset =>\r\n        dataset.data.slice(-dataPoints),\r\n      );\r\n    } else if (direction < 0) {\r\n      // removing data\r\n      chart.data.labels?.pop();\r\n      chart.data.datasets.forEach(set => set.data.pop());\r\n    }\r\n    return { labels, dataSetsDiff, direction };\r\n  }\r\n}\r\n\r\ndeclare global {\r\n  interface HTMLElementTagNameMap {\r\n    'zwc-chart-bar': ZwcChartBar;\r\n  }\r\n}\r\n"],"names":["ZwcChartBar","ZwcBaseChart","Colors","BarController","BarElement","CategoryScale","LinearScale","Legend","Tooltip","Title","SubTitle","changed","labels","dataSetsDiff","_b","_a","_c","dataset","index","chart","newData","direction","dataPoints","_d","set","__decorateClass","property","value","oldValue","isSameData","customElement"],"mappings":"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"}