"use strict";const f=require("./lib/utils.cjs"),w=require("./lib/date.cjs"),p=require("./lib/date-format.cjs"),v=require("./lib/dom.cjs"),m=require("./lib/event.cjs"),l=require("./i18n/base-locales.cjs"),y=require("./options/defaultOptions.cjs"),b=require("./options/processOptions.cjs"),F=require("./picker/Picker.cjs"),L=require("./events/functions.cjs"),h=require("./events/inputFieldListeners.cjs"),q=require("./events/otherListeners.cjs");function j(a,t){return a.map(i=>p.formatDate(i,t.format,t.locale)).join(t.dateDelimiter)}function O(a,t,i=!1){const{config:e,dates:n,rangeSideIndex:c}=a;if(t.length===0)return i?[]:void 0;let s=t.reduce((r,d)=>{let o=p.parseDate(d,e.format,e.locale);return o===void 0||(o=w.regularizeDate(o,e.pickLevel,c),f.isInRange(o,e.minDate,e.maxDate)&&!r.includes(o)&&!e.datesDisabled.includes(o)&&(e.pickLevel>0||!e.daysOfWeekDisabled.includes(new Date(o).getDay()))&&r.push(o)),r},[]);if(s.length!==0)return e.multidate&&!i&&(s=s.reduce((r,d)=>(n.includes(d)||r.push(d),r),n.filter(r=>!s.includes(r)))),e.maxNumberOfDates&&s.length>e.maxNumberOfDates?s.slice(e.maxNumberOfDates*-1):s}function D(a,t=3,i=!0){const{config:e,picker:n,inputField:c}=a;if(t&2){const s=n.active?e.pickLevel:e.startView;n.update().changeView(s).render(i)}t&1&&c&&(c.value=j(a.dates,e))}function k(a,t,i){let{clear:e,render:n,autohide:c,revert:s}=i;n===void 0&&(n=!0),n?c===void 0&&(c=a.config.autohide):c=!1;const r=O(a,t,e);!r&&!s||(r&&r.toString()!==a.dates.toString()?(a.dates=r,D(a,n?3:1),L.triggerDatepickerEvent(a,"changeDate")):D(a,1),c&&a.hide())}class x{constructor(t,i={},e=void 0){t.datepicker=this,this.element=t;const n=this.config=Object.assign({buttonClass:i.buttonClass&&String(i.buttonClass)||"button",container:null,defaultViewDate:w.today(),maxDate:void 0,minDate:void 0},b(y,this)),c=this.inline=t.tagName!=="INPUT";let s;if(c?n.container=t:(i.container&&(n.container=i.container instanceof HTMLElement?i.container:document.querySelector(i.container)),s=this.inputField=t,s.classList.add("datepicker-input")),e){const u=e.inputs.indexOf(s),g=e.datepickers;if(u<0||u>1||!Array.isArray(g))throw Error("Invalid rangepicker object.");g[u]=this,Object.defineProperty(this,"rangepicker",{get(){return e}}),Object.defineProperty(this,"rangeSideIndex",{get(){return u}})}this._options=i,Object.assign(n,b(i,this));let r;c?(r=f.stringToArray(t.dataset.date,n.dateDelimiter),delete t.dataset.date):r=f.stringToArray(s.value,n.dateDelimiter),this.dates=[];const d=O(this,r);d&&d.length>0&&(this.dates=d),s&&(s.value=j(this.dates,n));const o=this.picker=new F(this);if(c)this.show();else{const u=q.onClickOutside.bind(null,this),g=[[s,"keydown",h.onKeydown.bind(null,this)],[s,"focus",h.onFocus.bind(null,this)],[s,"mousedown",h.onMousedown.bind(null,this)],[s,"click",h.onClickInput.bind(null,this)],[s,"paste",h.onPaste.bind(null,this)],[document,"mousedown",u],[document,"touchstart",u],[window,"resize",o.place.bind(o)]];m.registerListeners(this,g)}}static formatDate(t,i,e){return p.formatDate(t,i,e&&l.locales[e]||l.locales.en)}static parseDate(t,i,e){return p.parseDate(t,i,e&&l.locales[e]||l.locales.en)}static get locales(){return l.locales}get active(){return!!(this.picker&&this.picker.active)}get pickerElement(){return this.picker?this.picker.element:void 0}setOptions(t){const i=this.picker,e=b(t,this);Object.assign(this._options,t),Object.assign(this.config,e),i.setOptions(e),D(this,3)}show(){if(this.inputField){if(this.inputField.disabled)return;!v.isActiveElement(this.inputField)&&!this.config.disableTouchKeyboard&&(this._showing=!0,this.inputField.focus(),delete this._showing)}this.picker.show()}hide(){this.inline||(this.picker.hide(),this.picker.update().changeView(this.config.startView).render())}destroy(){return this.hide(),m.unregisterListeners(this),this.picker.detach(),this.inline||this.inputField.classList.remove("datepicker-input"),delete this.element.datepicker,this}getDate(t=void 0){const i=t?e=>p.formatDate(e,t,this.config.locale):e=>new Date(e);if(this.config.multidate)return this.dates.map(i);if(this.dates.length>0)return i(this.dates[0])}setDate(...t){const i=[...t],e={},n=f.lastItemOf(t);typeof n=="object"&&!Array.isArray(n)&&!(n instanceof Date)&&n&&Object.assign(e,i.pop());const c=Array.isArray(i[0])?i[0]:i;k(this,c,e)}update(t=void 0){if(this.inline)return;const i=Object.assign(t||{},{clear:!0,render:!0}),e=f.stringToArray(this.inputField.value,this.config.dateDelimiter);k(this,e,i)}refresh(t=void 0,i=!1){t&&typeof t!="string"&&(i=t,t=void 0);let e;t==="picker"?e=2:t==="input"?e=1:e=3,D(this,e,!i)}enterEditMode(){this.inline||!this.picker.active||this.editMode||(this.editMode=!0,this.inputField.classList.add("in-edit"))}exitEditMode(t=void 0){if(this.inline||!this.editMode)return;const i=Object.assign({update:!1},t);delete this.editMode,this.inputField.classList.remove("in-edit"),i.update&&this.update(i)}}module.exports=x;
//# sourceMappingURL=Datepicker.cjs.map
