{"version":3,"file":"inputFieldListeners.js","sources":["../../../../../../../node_modules/vanillajs-datepicker/js/events/inputFieldListeners.js"],"sourcesContent":["import {isInRange} from '../lib/utils.js';\nimport {isActiveElement} from '../lib/dom.js';\nimport {addDays, addMonths, addYears, startOfYearPeriod} from '../lib/date.js';\nimport {goToPrevOrNext, switchView, unfocus} from './functions.js';\n\n// Find the closest date that doesn't meet the condition for unavailable date\n// Returns undefined if no available date is found\n// addFn: function to calculate the next date\n//   - args: time value, amount\n// increase: amount to pass to addFn\n// testFn: function to test the unavailablity of the date\n//   - args: time value; retun: true if unavailable\nfunction findNextAvailableOne(date, addFn, increase, testFn, min, max) {\n  if (!isInRange(date, min, max)) {\n    return;\n  }\n  if (testFn(date)) {\n    const newDate = addFn(date, increase);\n    return findNextAvailableOne(newDate, addFn, increase, testFn, min, max);\n  }\n  return date;\n}\n\n// direction: -1 (left/up), 1 (right/down)\n// vertical: true for up/down, false for left/right\nfunction moveByArrowKey(datepicker, ev, direction, vertical) {\n  const picker = datepicker.picker;\n  const currentView = picker.currentView;\n  const step = currentView.step || 1;\n  let viewDate = picker.viewDate;\n  let addFn;\n  let testFn;\n  switch (currentView.id) {\n    case 0:\n      if (vertical) {\n        viewDate = addDays(viewDate, direction * 7);\n      } else if (ev.ctrlKey || ev.metaKey) {\n        viewDate = addYears(viewDate, direction);\n      } else {\n        viewDate = addDays(viewDate, direction);\n      }\n      addFn = addDays;\n      testFn = (date) => currentView.disabled.includes(date);\n      break;\n    case 1:\n      viewDate = addMonths(viewDate, vertical ? direction * 4 : direction);\n      addFn = addMonths;\n      testFn = (date) => {\n        const dt = new Date(date);\n        const {year, disabled} = currentView;\n        return dt.getFullYear() === year && disabled.includes(dt.getMonth());\n      };\n      break;\n    default:\n      viewDate = addYears(viewDate, direction * (vertical ? 4 : 1) * step);\n      addFn = addYears;\n      testFn = date => currentView.disabled.includes(startOfYearPeriod(date, step));\n  }\n  viewDate = findNextAvailableOne(\n    viewDate,\n    addFn,\n    direction < 0 ? -step : step,\n    testFn,\n    currentView.minDate,\n    currentView.maxDate\n  );\n  if (viewDate !== undefined) {\n    picker.changeFocus(viewDate).render();\n  }\n}\n\nexport function onKeydown(datepicker, ev) {\n  const key = ev.key;\n  if (key === 'Tab') {\n    unfocus(datepicker);\n    return;\n  }\n\n  const picker = datepicker.picker;\n  const {id, isMinView} = picker.currentView;\n  if (!picker.active) {\n    if (key === 'ArrowDown') {\n      picker.show();\n    } else {\n      if (key === 'Enter') {\n        datepicker.update();\n      } else if (key === 'Escape') {\n        picker.show();\n      }\n      return;\n    }\n  } else if (datepicker.editMode) {\n    if (key === 'Enter') {\n      datepicker.exitEditMode({update: true, autohide: datepicker.config.autohide});\n    } else if (key === 'Escape') {\n      picker.hide();\n    }\n    return;\n  } else {\n    if (key === 'ArrowLeft') {\n      if (ev.ctrlKey || ev.metaKey) {\n        goToPrevOrNext(datepicker, -1);\n      } else if (ev.shiftKey) {\n        datepicker.enterEditMode();\n        return;\n      } else {\n        moveByArrowKey(datepicker, ev, -1, false);\n      }\n    } else if (key === 'ArrowRight') {\n      if (ev.ctrlKey || ev.metaKey) {\n        goToPrevOrNext(datepicker, 1);\n      } else if (ev.shiftKey) {\n        datepicker.enterEditMode();\n        return;\n      } else {\n        moveByArrowKey(datepicker, ev, 1, false);\n      }\n    } else if (key === 'ArrowUp') {\n      if (ev.ctrlKey || ev.metaKey) {\n        switchView(datepicker);\n      } else if (ev.shiftKey) {\n        datepicker.enterEditMode();\n        return;\n      } else {\n        moveByArrowKey(datepicker, ev, -1, true);\n      }\n    } else if (key === 'ArrowDown') {\n      if (ev.shiftKey && !ev.ctrlKey && !ev.metaKey) {\n        datepicker.enterEditMode();\n        return;\n      }\n      moveByArrowKey(datepicker, ev, 1, true);\n    } else if (key === 'Enter') {\n      if (isMinView) {\n        datepicker.setDate(picker.viewDate);\n        return;\n      }\n      picker.changeView(id - 1).render();\n    } else {\n      if (key === 'Escape') {\n        picker.hide();\n      } else if (\n        key === 'Backspace'\n        || key === 'Delete'\n        || (key.length === 1 && !ev.ctrlKey && !ev.metaKey)\n      ) {\n        datepicker.enterEditMode();\n      }\n      return;\n    }\n  }\n  ev.preventDefault();\n}\n\nexport function onFocus(datepicker) {\n  if (datepicker.config.showOnFocus && !datepicker._showing) {\n    datepicker.show();\n  }\n}\n\n// for the prevention for entering edit mode while getting focus on click\nexport function onMousedown(datepicker, ev) {\n  const el = ev.target;\n  if (datepicker.picker.active || datepicker.config.showOnClick) {\n    el._active = isActiveElement(el);\n    el._clicking = setTimeout(() => {\n      delete el._active;\n      delete el._clicking;\n    }, 2000);\n  }\n}\n\nexport function onClickInput(datepicker, ev) {\n  const el = ev.target;\n  if (!el._clicking) {\n    return;\n  }\n  clearTimeout(el._clicking);\n  delete el._clicking;\n\n  if (el._active) {\n    datepicker.enterEditMode();\n  }\n  delete el._active;\n\n  if (datepicker.config.showOnClick) {\n    datepicker.show();\n  }\n}\n\nexport function onPaste(datepicker, ev) {\n  if (ev.clipboardData.types.includes('text/plain')) {\n    datepicker.enterEditMode();\n  }\n}\n"],"names":["findNextAvailableOne","date","addFn","increase","testFn","min","max","isInRange","newDate","moveByArrowKey","datepicker","ev","direction","vertical","picker","currentView","step","viewDate","addDays","addYears","addMonths","dt","year","disabled","startOfYearPeriod","onKeydown","key","unfocus","id","isMinView","goToPrevOrNext","switchView","onFocus","onMousedown","el","isActiveElement","onClickInput","onPaste"],"mappings":"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"}