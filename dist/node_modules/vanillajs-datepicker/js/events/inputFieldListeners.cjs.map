{"version":3,"file":"inputFieldListeners.cjs","sources":["../../../../../../../node_modules/vanillajs-datepicker/js/events/inputFieldListeners.js"],"sourcesContent":["import {isInRange} from '../lib/utils.js';\nimport {isActiveElement} from '../lib/dom.js';\nimport {addDays, addMonths, addYears, startOfYearPeriod} from '../lib/date.js';\nimport {goToPrevOrNext, switchView, unfocus} from './functions.js';\n\n// Find the closest date that doesn't meet the condition for unavailable date\n// Returns undefined if no available date is found\n// addFn: function to calculate the next date\n//   - args: time value, amount\n// increase: amount to pass to addFn\n// testFn: function to test the unavailablity of the date\n//   - args: time value; retun: true if unavailable\nfunction findNextAvailableOne(date, addFn, increase, testFn, min, max) {\n  if (!isInRange(date, min, max)) {\n    return;\n  }\n  if (testFn(date)) {\n    const newDate = addFn(date, increase);\n    return findNextAvailableOne(newDate, addFn, increase, testFn, min, max);\n  }\n  return date;\n}\n\n// direction: -1 (left/up), 1 (right/down)\n// vertical: true for up/down, false for left/right\nfunction moveByArrowKey(datepicker, ev, direction, vertical) {\n  const picker = datepicker.picker;\n  const currentView = picker.currentView;\n  const step = currentView.step || 1;\n  let viewDate = picker.viewDate;\n  let addFn;\n  let testFn;\n  switch (currentView.id) {\n    case 0:\n      if (vertical) {\n        viewDate = addDays(viewDate, direction * 7);\n      } else if (ev.ctrlKey || ev.metaKey) {\n        viewDate = addYears(viewDate, direction);\n      } else {\n        viewDate = addDays(viewDate, direction);\n      }\n      addFn = addDays;\n      testFn = (date) => currentView.disabled.includes(date);\n      break;\n    case 1:\n      viewDate = addMonths(viewDate, vertical ? direction * 4 : direction);\n      addFn = addMonths;\n      testFn = (date) => {\n        const dt = new Date(date);\n        const {year, disabled} = currentView;\n        return dt.getFullYear() === year && disabled.includes(dt.getMonth());\n      };\n      break;\n    default:\n      viewDate = addYears(viewDate, direction * (vertical ? 4 : 1) * step);\n      addFn = addYears;\n      testFn = date => currentView.disabled.includes(startOfYearPeriod(date, step));\n  }\n  viewDate = findNextAvailableOne(\n    viewDate,\n    addFn,\n    direction < 0 ? -step : step,\n    testFn,\n    currentView.minDate,\n    currentView.maxDate\n  );\n  if (viewDate !== undefined) {\n    picker.changeFocus(viewDate).render();\n  }\n}\n\nexport function onKeydown(datepicker, ev) {\n  const key = ev.key;\n  if (key === 'Tab') {\n    unfocus(datepicker);\n    return;\n  }\n\n  const picker = datepicker.picker;\n  const {id, isMinView} = picker.currentView;\n  if (!picker.active) {\n    if (key === 'ArrowDown') {\n      picker.show();\n    } else {\n      if (key === 'Enter') {\n        datepicker.update();\n      } else if (key === 'Escape') {\n        picker.show();\n      }\n      return;\n    }\n  } else if (datepicker.editMode) {\n    if (key === 'Enter') {\n      datepicker.exitEditMode({update: true, autohide: datepicker.config.autohide});\n    } else if (key === 'Escape') {\n      picker.hide();\n    }\n    return;\n  } else {\n    if (key === 'ArrowLeft') {\n      if (ev.ctrlKey || ev.metaKey) {\n        goToPrevOrNext(datepicker, -1);\n      } else if (ev.shiftKey) {\n        datepicker.enterEditMode();\n        return;\n      } else {\n        moveByArrowKey(datepicker, ev, -1, false);\n      }\n    } else if (key === 'ArrowRight') {\n      if (ev.ctrlKey || ev.metaKey) {\n        goToPrevOrNext(datepicker, 1);\n      } else if (ev.shiftKey) {\n        datepicker.enterEditMode();\n        return;\n      } else {\n        moveByArrowKey(datepicker, ev, 1, false);\n      }\n    } else if (key === 'ArrowUp') {\n      if (ev.ctrlKey || ev.metaKey) {\n        switchView(datepicker);\n      } else if (ev.shiftKey) {\n        datepicker.enterEditMode();\n        return;\n      } else {\n        moveByArrowKey(datepicker, ev, -1, true);\n      }\n    } else if (key === 'ArrowDown') {\n      if (ev.shiftKey && !ev.ctrlKey && !ev.metaKey) {\n        datepicker.enterEditMode();\n        return;\n      }\n      moveByArrowKey(datepicker, ev, 1, true);\n    } else if (key === 'Enter') {\n      if (isMinView) {\n        datepicker.setDate(picker.viewDate);\n        return;\n      }\n      picker.changeView(id - 1).render();\n    } else {\n      if (key === 'Escape') {\n        picker.hide();\n      } else if (\n        key === 'Backspace'\n        || key === 'Delete'\n        || (key.length === 1 && !ev.ctrlKey && !ev.metaKey)\n      ) {\n        datepicker.enterEditMode();\n      }\n      return;\n    }\n  }\n  ev.preventDefault();\n}\n\nexport function onFocus(datepicker) {\n  if (datepicker.config.showOnFocus && !datepicker._showing) {\n    datepicker.show();\n  }\n}\n\n// for the prevention for entering edit mode while getting focus on click\nexport function onMousedown(datepicker, ev) {\n  const el = ev.target;\n  if (datepicker.picker.active || datepicker.config.showOnClick) {\n    el._active = isActiveElement(el);\n    el._clicking = setTimeout(() => {\n      delete el._active;\n      delete el._clicking;\n    }, 2000);\n  }\n}\n\nexport function onClickInput(datepicker, ev) {\n  const el = ev.target;\n  if (!el._clicking) {\n    return;\n  }\n  clearTimeout(el._clicking);\n  delete el._clicking;\n\n  if (el._active) {\n    datepicker.enterEditMode();\n  }\n  delete el._active;\n\n  if (datepicker.config.showOnClick) {\n    datepicker.show();\n  }\n}\n\nexport function onPaste(datepicker, ev) {\n  if (ev.clipboardData.types.includes('text/plain')) {\n    datepicker.enterEditMode();\n  }\n}\n"],"names":["findNextAvailableOne","date","addFn","increase","testFn","min","max","isInRange","newDate","moveByArrowKey","datepicker","ev","direction","vertical","picker","currentView","step","viewDate","addDays","addYears","addMonths","dt","year","disabled","startOfYearPeriod","onKeydown","key","unfocus","id","isMinView","goToPrevOrNext","switchView","onFocus","onMousedown","el","isActiveElement","onClickInput","onPaste"],"mappings":"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"}