{"version":3,"file":"processOptions.js","sources":["../../../../../../../node_modules/vanillajs-datepicker/js/options/processOptions.js"],"sourcesContent":["import {hasProperty, pushUnique} from '../lib/utils.js';\nimport {dateValue, regularizeDate} from '../lib/date.js';\nimport {reFormatTokens, parseDate} from '../lib/date-format.js';\nimport {parseHTML} from '../lib/dom.js';\nimport defaultOptions from './defaultOptions.js';\n\nconst {\n  language: defaultLang,\n  format: defaultFormat,\n  weekStart: defaultWeekStart,\n} = defaultOptions;\n\n// Reducer function to filter out invalid day-of-week from the input\nfunction sanitizeDOW(dow, day) {\n  return dow.length < 6 && day >= 0 && day < 7\n    ? pushUnique(dow, day)\n    : dow;\n}\n\nfunction calcEndOfWeek(startOfWeek) {\n  return (startOfWeek + 6) % 7;\n}\n\n// validate input date. if invalid, fallback to the original value\nfunction validateDate(value, format, locale, origValue) {\n  const date = parseDate(value, format, locale);\n  return date !== undefined ? date : origValue;\n}\n\n// Validate viewId. if invalid, fallback to the original value\nfunction validateViewId(value, origValue, max = 3) {\n  const viewId = parseInt(value, 10);\n  return viewId >= 0 && viewId <= max ? viewId : origValue;\n}\n\n// Create Datepicker configuration to set\nexport default function processOptions(options, datepicker) {\n  const inOpts = Object.assign({}, options);\n  const config = {};\n  const locales = datepicker.constructor.locales;\n  const rangeSideIndex = datepicker.rangeSideIndex;\n  let {\n    format,\n    language,\n    locale,\n    maxDate,\n    maxView,\n    minDate,\n    pickLevel,\n    startView,\n    weekStart,\n  } = datepicker.config || {};\n\n  if (inOpts.language) {\n    let lang;\n    if (inOpts.language !== language) {\n      if (locales[inOpts.language]) {\n        lang = inOpts.language;\n      } else {\n        // Check if langauge + region tag can fallback to the one without\n        // region (e.g. fr-CA â†’ fr)\n        lang = inOpts.language.split('-')[0];\n        if (locales[lang] === undefined) {\n          lang = false;\n        }\n      }\n    }\n    delete inOpts.language;\n    if (lang) {\n      language = config.language = lang;\n\n      // update locale as well when updating language\n      const origLocale = locale || locales[defaultLang];\n      // use default language's properties for the fallback\n      locale = Object.assign({\n        format: defaultFormat,\n        weekStart: defaultWeekStart\n      }, locales[defaultLang]);\n      if (language !== defaultLang) {\n        Object.assign(locale, locales[language]);\n      }\n      config.locale = locale;\n      // if format and/or weekStart are the same as old locale's defaults,\n      // update them to new locale's defaults\n      if (format === origLocale.format) {\n        format = config.format = locale.format;\n      }\n      if (weekStart === origLocale.weekStart) {\n        weekStart = config.weekStart = locale.weekStart;\n        config.weekEnd = calcEndOfWeek(locale.weekStart);\n      }\n    }\n  }\n\n  if (inOpts.format) {\n    const hasToDisplay = typeof inOpts.format.toDisplay === 'function';\n    const hasToValue = typeof inOpts.format.toValue === 'function';\n    const validFormatString = reFormatTokens.test(inOpts.format);\n    if ((hasToDisplay && hasToValue) || validFormatString) {\n      format = config.format = inOpts.format;\n    }\n    delete inOpts.format;\n  }\n\n  //*** pick level ***//\n  let newPickLevel = pickLevel;\n  if (inOpts.pickLevel !== undefined) {\n    newPickLevel = validateViewId(inOpts.pickLevel, 2);\n    delete inOpts.pickLevel;\n  }\n  if (newPickLevel !== pickLevel) {\n    if (newPickLevel > pickLevel) {\n      // complement current minDate/madDate so that the existing range will be\n      // expanded to fit the new level later\n      if (inOpts.minDate === undefined) {\n        inOpts.minDate = minDate;\n      }\n      if (inOpts.maxDate === undefined) {\n        inOpts.maxDate = maxDate;\n      }\n    }\n    // complement datesDisabled so that it will be reset later\n    if (!inOpts.datesDisabled) {\n      inOpts.datesDisabled = [];\n    }\n    pickLevel = config.pickLevel = newPickLevel;\n  }\n\n  //*** dates ***//\n  // while min and maxDate for \"no limit\" in the options are better to be null\n  // (especially when updating), the ones in the config have to be undefined\n  // because null is treated as 0 (= unix epoch) when comparing with time value\n  let minDt = minDate;\n  let maxDt = maxDate;\n  if (inOpts.minDate !== undefined) {\n    const defaultMinDt = dateValue(0, 0, 1);\n    minDt = inOpts.minDate === null\n      ? defaultMinDt  // set 0000-01-01 to prevent negative values for year\n      : validateDate(inOpts.minDate, format, locale, minDt);\n    if (minDt !== defaultMinDt) {\n      minDt = regularizeDate(minDt, pickLevel, false);\n    }\n    delete inOpts.minDate;\n  }\n  if (inOpts.maxDate !== undefined) {\n    maxDt = inOpts.maxDate === null\n      ? undefined\n      : validateDate(inOpts.maxDate, format, locale, maxDt);\n    if (maxDt !== undefined) {\n      maxDt = regularizeDate(maxDt, pickLevel, true);\n    }\n    delete inOpts.maxDate;\n  }\n  if (maxDt < minDt) {\n    minDate = config.minDate = maxDt;\n    maxDate = config.maxDate = minDt;\n  } else {\n    if (minDate !== minDt) {\n      minDate = config.minDate = minDt;\n    }\n    if (maxDate !== maxDt) {\n      maxDate = config.maxDate = maxDt;\n    }\n  }\n\n  if (inOpts.datesDisabled) {\n    config.datesDisabled = inOpts.datesDisabled.reduce((dates, dt) => {\n      const date = parseDate(dt, format, locale);\n      return date !== undefined\n        ? pushUnique(dates, regularizeDate(date, pickLevel, rangeSideIndex))\n        : dates;\n    }, []);\n    delete inOpts.datesDisabled;\n  }\n  if (inOpts.defaultViewDate !== undefined) {\n    const viewDate = parseDate(inOpts.defaultViewDate, format, locale);\n    if (viewDate !== undefined) {\n      config.defaultViewDate = viewDate;\n    }\n    delete inOpts.defaultViewDate;\n  }\n\n  //*** days of week ***//\n  if (inOpts.weekStart !== undefined) {\n    const wkStart = Number(inOpts.weekStart) % 7;\n    if (!isNaN(wkStart)) {\n      weekStart = config.weekStart = wkStart;\n      config.weekEnd = calcEndOfWeek(wkStart);\n    }\n    delete inOpts.weekStart;\n  }\n  if (inOpts.daysOfWeekDisabled) {\n    config.daysOfWeekDisabled = inOpts.daysOfWeekDisabled.reduce(sanitizeDOW, []);\n    delete inOpts.daysOfWeekDisabled;\n  }\n  if (inOpts.daysOfWeekHighlighted) {\n    config.daysOfWeekHighlighted = inOpts.daysOfWeekHighlighted.reduce(sanitizeDOW, []);\n    delete inOpts.daysOfWeekHighlighted;\n  }\n\n  //*** multi date ***//\n  if (inOpts.maxNumberOfDates !== undefined) {\n    const maxNumberOfDates = parseInt(inOpts.maxNumberOfDates, 10);\n    if (maxNumberOfDates >= 0) {\n      config.maxNumberOfDates = maxNumberOfDates;\n      config.multidate = maxNumberOfDates !== 1;\n    }\n    delete inOpts.maxNumberOfDates;\n  }\n  if (inOpts.dateDelimiter) {\n    config.dateDelimiter = String(inOpts.dateDelimiter);\n    delete inOpts.dateDelimiter;\n  }\n\n  //*** view ***//\n  let newMaxView = maxView;\n  if (inOpts.maxView !== undefined) {\n    newMaxView = validateViewId(inOpts.maxView, maxView);\n    delete inOpts.maxView;\n  }\n  // ensure max view >= pick level\n  newMaxView = pickLevel > newMaxView ? pickLevel : newMaxView;\n  if (newMaxView !== maxView) {\n    maxView = config.maxView = newMaxView;\n  }\n\n  let newStartView = startView;\n  if (inOpts.startView !== undefined) {\n    newStartView = validateViewId(inOpts.startView, newStartView);\n    delete inOpts.startView;\n  }\n  // ensure pick level <= start view <= max view\n  if (newStartView < pickLevel) {\n    newStartView = pickLevel;\n  } else if (newStartView > maxView) {\n    newStartView = maxView;\n  }\n  if (newStartView !== startView) {\n    config.startView = newStartView;\n  }\n\n  //*** template ***//\n  if (inOpts.prevArrow) {\n    const prevArrow = parseHTML(inOpts.prevArrow);\n    if (prevArrow.childNodes.length > 0) {\n      config.prevArrow = prevArrow.childNodes;\n    }\n    delete inOpts.prevArrow;\n  }\n  if (inOpts.nextArrow) {\n    const nextArrow = parseHTML(inOpts.nextArrow);\n    if (nextArrow.childNodes.length > 0) {\n      config.nextArrow = nextArrow.childNodes;\n    }\n    delete inOpts.nextArrow;\n  }\n\n  //*** misc ***//\n  if (inOpts.disableTouchKeyboard !== undefined) {\n    config.disableTouchKeyboard = 'ontouchstart' in document && !!inOpts.disableTouchKeyboard;\n    delete inOpts.disableTouchKeyboard;\n  }\n  if (inOpts.orientation) {\n    const orientation = inOpts.orientation.toLowerCase().split(/\\s+/g);\n    config.orientation = {\n      x: orientation.find(x => (x === 'left' || x === 'right')) || 'auto',\n      y: orientation.find(y => (y === 'top' || y === 'bottom')) || 'auto',\n    };\n    delete inOpts.orientation;\n  }\n  if (inOpts.todayBtnMode !== undefined) {\n    switch(inOpts.todayBtnMode) {\n      case 0:\n      case 1:\n        config.todayBtnMode = inOpts.todayBtnMode;\n    }\n    delete inOpts.todayBtnMode;\n  }\n\n  //*** copy the rest ***//\n  Object.keys(inOpts).forEach((key) => {\n    if (inOpts[key] !== undefined && hasProperty(defaultOptions, key)) {\n      config[key] = inOpts[key];\n    }\n  });\n\n  return config;\n}\n"],"names":["defaultLang","defaultFormat","defaultWeekStart","defaultOptions","sanitizeDOW","dow","day","pushUnique","calcEndOfWeek","startOfWeek","validateDate","value","format","locale","origValue","date","parseDate","validateViewId","max","viewId","processOptions","options","datepicker","inOpts","config","locales","rangeSideIndex","language","maxDate","maxView","minDate","pickLevel","startView","weekStart","lang","origLocale","hasToDisplay","hasToValue","validFormatString","reFormatTokens","newPickLevel","minDt","maxDt","defaultMinDt","dateValue","regularizeDate","dates","dt","viewDate","wkStart","maxNumberOfDates","newMaxView","newStartView","prevArrow","parseHTML","nextArrow","orientation","x","y","key","hasProperty"],"mappings":";;;;;AAMA,MAAM;AAAA,EACJ,UAAUA;AAAA,EACV,QAAQC;AAAA,EACR,WAAWC;AACb,IAAIC;AAGJ,SAASC,EAAYC,GAAKC,GAAK;AAC7B,SAAOD,EAAI,SAAS,KAAKC,KAAO,KAAKA,IAAM,IACvCC,EAAWF,GAAKC,CAAG,IACnBD;AACN;AAEA,SAASG,EAAcC,GAAa;AAClC,UAAQA,IAAc,KAAK;AAC7B;AAGA,SAASC,EAAaC,GAAOC,GAAQC,GAAQC,GAAW;AACtD,QAAMC,IAAOC,EAAUL,GAAOC,GAAQC,CAAM;AAC5C,SAAOE,MAAS,SAAYA,IAAOD;AACrC;AAGA,SAASG,EAAeN,GAAOG,GAAWI,IAAM,GAAG;AACjD,QAAMC,IAAS,SAASR,GAAO,EAAE;AACjC,SAAOQ,KAAU,KAAKA,KAAUD,IAAMC,IAASL;AACjD;AAGe,SAASM,EAAeC,GAASC,GAAY;AAC1D,QAAMC,IAAS,OAAO,OAAO,CAAE,GAAEF,CAAO,GAClCG,IAAS,CAAA,GACTC,IAAUH,EAAW,YAAY,SACjCI,IAAiBJ,EAAW;AAClC,MAAI;AAAA,IACF,QAAAV;AAAA,IACA,UAAAe;AAAA,IACA,QAAAd;AAAA,IACA,SAAAe;AAAA,IACA,SAAAC;AAAA,IACA,SAAAC;AAAA,IACA,WAAAC;AAAA,IACA,WAAAC;AAAA,IACA,WAAAC;AAAA,EACJ,IAAMX,EAAW,UAAU;AAEzB,MAAIC,EAAO,UAAU;AACnB,QAAIW;AAcJ,QAbIX,EAAO,aAAaI,MAClBF,EAAQF,EAAO,YACjBW,IAAOX,EAAO,YAIdW,IAAOX,EAAO,SAAS,MAAM,GAAG,EAAE,IAC9BE,EAAQS,OAAU,WACpBA,IAAO,OAIb,OAAOX,EAAO,UACVW,GAAM;AACR,MAAAP,IAAWH,EAAO,WAAWU;AAG7B,YAAMC,IAAatB,KAAUY,EAAQzB;AAErC,MAAAa,IAAS,OAAO,OAAO;AAAA,QACrB,QAAQZ;AAAA,QACR,WAAWC;AAAA,MACnB,GAASuB,EAAQzB,EAAY,GACnB2B,MAAa3B,KACf,OAAO,OAAOa,GAAQY,EAAQE,EAAS,GAEzCH,EAAO,SAASX,GAGZD,MAAWuB,EAAW,WACxBvB,IAASY,EAAO,SAASX,EAAO,SAE9BoB,MAAcE,EAAW,cAC3BF,IAAYT,EAAO,YAAYX,EAAO,WACtCW,EAAO,UAAUhB,EAAcK,EAAO,SAAS;AAAA,IAElD;AAAA,EACF;AAED,MAAIU,EAAO,QAAQ;AACjB,UAAMa,IAAe,OAAOb,EAAO,OAAO,aAAc,YAClDc,IAAa,OAAOd,EAAO,OAAO,WAAY,YAC9Ce,IAAoBC,EAAe,KAAKhB,EAAO,MAAM;AAC3D,KAAKa,KAAgBC,KAAeC,OAClC1B,IAASY,EAAO,SAASD,EAAO,SAElC,OAAOA,EAAO;AAAA,EACf;AAGD,MAAIiB,IAAeT;AACnB,EAAIR,EAAO,cAAc,WACvBiB,IAAevB,EAAeM,EAAO,WAAW,CAAC,GACjD,OAAOA,EAAO,YAEZiB,MAAiBT,MACfS,IAAeT,MAGbR,EAAO,YAAY,WACrBA,EAAO,UAAUO,IAEfP,EAAO,YAAY,WACrBA,EAAO,UAAUK,KAIhBL,EAAO,kBACVA,EAAO,gBAAgB,KAEzBQ,IAAYP,EAAO,YAAYgB;AAOjC,MAAIC,IAAQX,GACRY,IAAQd;AACZ,MAAIL,EAAO,YAAY,QAAW;AAChC,UAAMoB,IAAeC,EAAU,GAAG,GAAG,CAAC;AACtC,IAAAH,IAAQlB,EAAO,YAAY,OACvBoB,IACAjC,EAAaa,EAAO,SAASX,GAAQC,GAAQ4B,CAAK,GAClDA,MAAUE,MACZF,IAAQI,EAAeJ,GAAOV,GAAW,EAAK,IAEhD,OAAOR,EAAO;AAAA,EACf;AA+BD,MA9BIA,EAAO,YAAY,WACrBmB,IAAQnB,EAAO,YAAY,OACvB,SACAb,EAAaa,EAAO,SAASX,GAAQC,GAAQ6B,CAAK,GAClDA,MAAU,WACZA,IAAQG,EAAeH,GAAOX,GAAW,EAAI,IAE/C,OAAOR,EAAO,UAEZmB,IAAQD,KACVX,IAAUN,EAAO,UAAUkB,GAC3Bd,IAAUJ,EAAO,UAAUiB,MAEvBX,MAAYW,MACdX,IAAUN,EAAO,UAAUiB,IAEzBb,MAAYc,MACdd,IAAUJ,EAAO,UAAUkB,KAI3BnB,EAAO,kBACTC,EAAO,gBAAgBD,EAAO,cAAc,OAAO,CAACuB,GAAOC,MAAO;AAChE,UAAMhC,IAAOC,EAAU+B,GAAInC,GAAQC,CAAM;AACzC,WAAOE,MAAS,SACZR,EAAWuC,GAAOD,EAAe9B,GAAMgB,GAAWL,CAAc,CAAC,IACjEoB;AAAA,EACL,GAAE,CAAE,CAAA,GACL,OAAOvB,EAAO,gBAEZA,EAAO,oBAAoB,QAAW;AACxC,UAAMyB,IAAWhC,EAAUO,EAAO,iBAAiBX,GAAQC,CAAM;AACjE,IAAImC,MAAa,WACfxB,EAAO,kBAAkBwB,IAE3B,OAAOzB,EAAO;AAAA,EACf;AAGD,MAAIA,EAAO,cAAc,QAAW;AAClC,UAAM0B,IAAU,OAAO1B,EAAO,SAAS,IAAI;AAC3C,IAAK,MAAM0B,CAAO,MAChBhB,IAAYT,EAAO,YAAYyB,GAC/BzB,EAAO,UAAUhB,EAAcyC,CAAO,IAExC,OAAO1B,EAAO;AAAA,EACf;AAWD,MAVIA,EAAO,uBACTC,EAAO,qBAAqBD,EAAO,mBAAmB,OAAOnB,GAAa,CAAA,CAAE,GAC5E,OAAOmB,EAAO,qBAEZA,EAAO,0BACTC,EAAO,wBAAwBD,EAAO,sBAAsB,OAAOnB,GAAa,CAAA,CAAE,GAClF,OAAOmB,EAAO,wBAIZA,EAAO,qBAAqB,QAAW;AACzC,UAAM2B,IAAmB,SAAS3B,EAAO,kBAAkB,EAAE;AAC7D,IAAI2B,KAAoB,MACtB1B,EAAO,mBAAmB0B,GAC1B1B,EAAO,YAAY0B,MAAqB,IAE1C,OAAO3B,EAAO;AAAA,EACf;AACD,EAAIA,EAAO,kBACTC,EAAO,gBAAgB,OAAOD,EAAO,aAAa,GAClD,OAAOA,EAAO;AAIhB,MAAI4B,IAAatB;AACjB,EAAIN,EAAO,YAAY,WACrB4B,IAAalC,EAAeM,EAAO,SAASM,CAAO,GACnD,OAAON,EAAO,UAGhB4B,IAAapB,IAAYoB,IAAapB,IAAYoB,GAC9CA,MAAetB,MACjBA,IAAUL,EAAO,UAAU2B;AAG7B,MAAIC,IAAepB;AAgBnB,MAfIT,EAAO,cAAc,WACvB6B,IAAenC,EAAeM,EAAO,WAAW6B,CAAY,GAC5D,OAAO7B,EAAO,YAGZ6B,IAAerB,IACjBqB,IAAerB,IACNqB,IAAevB,MACxBuB,IAAevB,IAEbuB,MAAiBpB,MACnBR,EAAO,YAAY4B,IAIjB7B,EAAO,WAAW;AACpB,UAAM8B,IAAYC,EAAU/B,EAAO,SAAS;AAC5C,IAAI8B,EAAU,WAAW,SAAS,MAChC7B,EAAO,YAAY6B,EAAU,aAE/B,OAAO9B,EAAO;AAAA,EACf;AACD,MAAIA,EAAO,WAAW;AACpB,UAAMgC,IAAYD,EAAU/B,EAAO,SAAS;AAC5C,IAAIgC,EAAU,WAAW,SAAS,MAChC/B,EAAO,YAAY+B,EAAU,aAE/B,OAAOhC,EAAO;AAAA,EACf;AAOD,MAJIA,EAAO,yBAAyB,WAClCC,EAAO,uBAAuB,kBAAkB,YAAY,CAAC,CAACD,EAAO,sBACrE,OAAOA,EAAO,uBAEZA,EAAO,aAAa;AACtB,UAAMiC,IAAcjC,EAAO,YAAY,YAAW,EAAG,MAAM,MAAM;AACjE,IAAAC,EAAO,cAAc;AAAA,MACnB,GAAGgC,EAAY,KAAK,CAAAC,MAAMA,MAAM,UAAUA,MAAM,OAAQ,KAAK;AAAA,MAC7D,GAAGD,EAAY,KAAK,CAAAE,MAAMA,MAAM,SAASA,MAAM,QAAS,KAAK;AAAA,IACnE,GACI,OAAOnC,EAAO;AAAA,EACf;AACD,MAAIA,EAAO,iBAAiB,QAAW;AACrC,YAAOA,EAAO,cAAY;AAAA,MACxB,KAAK;AAAA,MACL,KAAK;AACH,QAAAC,EAAO,eAAeD,EAAO;AAAA,IAChC;AACD,WAAOA,EAAO;AAAA,EACf;AAGD,gBAAO,KAAKA,CAAM,EAAE,QAAQ,CAACoC,MAAQ;AACnC,IAAIpC,EAAOoC,OAAS,UAAaC,EAAYzD,GAAgBwD,CAAG,MAC9DnC,EAAOmC,KAAOpC,EAAOoC;AAAA,EAE3B,CAAG,GAEMnC;AACT;"}