{"version":3,"file":"DaysView.cjs","sources":["../../../../../../../../node_modules/vanillajs-datepicker/js/picker/views/DaysView.js"],"sourcesContent":["import {hasProperty, pushUnique} from '../../lib/utils.js';\nimport {today, dateValue, addDays, addWeeks, dayOfTheWeekOf, getWeek} from '../../lib/date.js';\nimport {formatDate} from '../../lib/date-format.js';\nimport {parseHTML, showElement, hideElement} from '../../lib/dom.js';\nimport daysTemplate from '../templates/daysTemplate.js';\nimport calendarWeeksTemplate from '../templates/calendarWeeksTemplate.js';\nimport View from './View.js';\n\nexport default class DaysView extends View {\n  constructor(picker) {\n    super(picker, {\n      id: 0,\n      name: 'days',\n      cellClass: 'day',\n    });\n  }\n\n  init(options, onConstruction = true) {\n    if (onConstruction) {\n      const inner = parseHTML(daysTemplate).firstChild;\n      this.dow = inner.firstChild;\n      this.grid = inner.lastChild;\n      this.element.appendChild(inner);\n    }\n    super.init(options);\n  }\n\n  setOptions(options) {\n    let updateDOW;\n\n    if (hasProperty(options, 'minDate')) {\n      this.minDate = options.minDate;\n    }\n    if (hasProperty(options, 'maxDate')) {\n      this.maxDate = options.maxDate;\n    }\n    if (options.datesDisabled) {\n      this.datesDisabled = options.datesDisabled;\n    }\n    if (options.daysOfWeekDisabled) {\n      this.daysOfWeekDisabled = options.daysOfWeekDisabled;\n      updateDOW = true;\n    }\n    if (options.daysOfWeekHighlighted) {\n      this.daysOfWeekHighlighted = options.daysOfWeekHighlighted;\n    }\n    if (options.todayHighlight !== undefined) {\n      this.todayHighlight = options.todayHighlight;\n    }\n    if (options.weekStart !== undefined) {\n      this.weekStart = options.weekStart;\n      this.weekEnd = options.weekEnd;\n      updateDOW = true;\n    }\n    if (options.locale) {\n      const locale = this.locale = options.locale;\n      this.dayNames = locale.daysMin;\n      this.switchLabelFormat = locale.titleFormat;\n      updateDOW = true;\n    }\n    if (options.beforeShowDay !== undefined) {\n      this.beforeShow = typeof options.beforeShowDay === 'function'\n        ? options.beforeShowDay\n        : undefined;\n    }\n\n    if (options.calendarWeeks !== undefined) {\n      if (options.calendarWeeks && !this.calendarWeeks) {\n        const weeksElem = parseHTML(calendarWeeksTemplate).firstChild;\n        this.calendarWeeks = {\n          element: weeksElem,\n          dow: weeksElem.firstChild,\n          weeks: weeksElem.lastChild,\n        };\n        this.element.insertBefore(weeksElem, this.element.firstChild);\n      } else if (this.calendarWeeks && !options.calendarWeeks) {\n        this.element.removeChild(this.calendarWeeks.element);\n        this.calendarWeeks = null;\n      }\n    }\n    if (options.showDaysOfWeek !== undefined) {\n      if (options.showDaysOfWeek) {\n        showElement(this.dow);\n        if (this.calendarWeeks) {\n          showElement(this.calendarWeeks.dow);\n        }\n      } else {\n        hideElement(this.dow);\n        if (this.calendarWeeks) {\n          hideElement(this.calendarWeeks.dow);\n        }\n      }\n    }\n\n    // update days-of-week when locale, daysOfweekDisabled or weekStart is changed\n    if (updateDOW) {\n      Array.from(this.dow.children).forEach((el, index) => {\n        const dow = (this.weekStart + index) % 7;\n        el.textContent = this.dayNames[dow];\n        el.className = this.daysOfWeekDisabled.includes(dow) ? 'dow disabled' : 'dow';\n      });\n    }\n  }\n\n  // Apply update on the focused date to view's settings\n  updateFocus() {\n    const viewDate = new Date(this.picker.viewDate);\n    const viewYear = viewDate.getFullYear();\n    const viewMonth = viewDate.getMonth();\n    const firstOfMonth = dateValue(viewYear, viewMonth, 1);\n    const start = dayOfTheWeekOf(firstOfMonth, this.weekStart, this.weekStart);\n\n    this.first = firstOfMonth;\n    this.last = dateValue(viewYear, viewMonth + 1, 0);\n    this.start = start;\n    this.focused = this.picker.viewDate;\n  }\n\n  // Apply update on the selected dates to view's settings\n  updateSelection() {\n    const {dates, rangepicker} = this.picker.datepicker;\n    this.selected = dates;\n    if (rangepicker) {\n      this.range = rangepicker.dates;\n    }\n  }\n\n   // Update the entire view UI\n  render() {\n    // update today marker on ever render\n    this.today = this.todayHighlight ? today() : undefined;\n    // refresh disabled dates on every render in order to clear the ones added\n    // by beforeShow hook at previous render\n    this.disabled = [...this.datesDisabled];\n\n    const switchLabel = formatDate(this.focused, this.switchLabelFormat, this.locale);\n    this.picker.setViewSwitchLabel(switchLabel);\n    this.picker.setPrevBtnDisabled(this.first <= this.minDate);\n    this.picker.setNextBtnDisabled(this.last >= this.maxDate);\n\n    if (this.calendarWeeks) {\n      // start of the UTC week (Monday) of the 1st of the month\n      const startOfWeek = dayOfTheWeekOf(this.first, 1, 1);\n      Array.from(this.calendarWeeks.weeks.children).forEach((el, index) => {\n        el.textContent = getWeek(addWeeks(startOfWeek, index));\n      });\n    }\n    Array.from(this.grid.children).forEach((el, index) => {\n      const classList = el.classList;\n      const current = addDays(this.start, index);\n      const date = new Date(current);\n      const day = date.getDay();\n\n      el.className = `datepicker-cell ${this.cellClass}`;\n      el.dataset.date = current;\n      el.textContent = date.getDate();\n\n      if (current < this.first) {\n        classList.add('prev');\n      } else if (current > this.last) {\n        classList.add('next');\n      }\n      if (this.today === current) {\n        classList.add('today');\n      }\n      if (current < this.minDate || current > this.maxDate || this.disabled.includes(current)) {\n        classList.add('disabled');\n      }\n      if (this.daysOfWeekDisabled.includes(day)) {\n        classList.add('disabled');\n        pushUnique(this.disabled, current);\n      }\n      if (this.daysOfWeekHighlighted.includes(day)) {\n        classList.add('highlighted');\n      }\n      if (this.range) {\n        const [rangeStart, rangeEnd] = this.range;\n        if (current > rangeStart && current < rangeEnd) {\n          classList.add('range');\n        }\n        if (current === rangeStart) {\n          classList.add('range-start');\n        }\n        if (current === rangeEnd) {\n          classList.add('range-end');\n        }\n      }\n      if (this.selected.includes(current)) {\n        classList.add('selected');\n      }\n      if (current === this.focused) {\n        classList.add('focused');\n      }\n\n      if (this.beforeShow) {\n        this.performBeforeHook(el, current, current);\n      }\n    });\n  }\n\n  // Update the view UI by applying the changes of selected and focused items\n  refresh() {\n    const [rangeStart, rangeEnd] = this.range || [];\n    this.grid\n      .querySelectorAll('.range, .range-start, .range-end, .selected, .focused')\n      .forEach((el) => {\n        el.classList.remove('range', 'range-start', 'range-end', 'selected', 'focused');\n      });\n    Array.from(this.grid.children).forEach((el) => {\n      const current = Number(el.dataset.date);\n      const classList = el.classList;\n      if (current > rangeStart && current < rangeEnd) {\n        classList.add('range');\n      }\n      if (current === rangeStart) {\n        classList.add('range-start');\n      }\n      if (current === rangeEnd) {\n        classList.add('range-end');\n      }\n      if (this.selected.includes(current)) {\n        classList.add('selected');\n      }\n      if (current === this.focused) {\n        classList.add('focused');\n      }\n    });\n  }\n\n  // Update the view UI by applying the change of focused item\n  refreshFocus() {\n    const index = Math.round((this.focused - this.start) / 86400000);\n    this.grid.querySelectorAll('.focused').forEach((el) => {\n      el.classList.remove('focused');\n    });\n    this.grid.children[index].classList.add('focused');\n  }\n}\n"],"names":["DaysView","View","picker","options","onConstruction","inner","parseHTML","daysTemplate","updateDOW","hasProperty","locale","weeksElem","calendarWeeksTemplate","showElement","hideElement","el","index","dow","viewDate","viewYear","viewMonth","firstOfMonth","dateValue","start","dayOfTheWeekOf","dates","rangepicker","today","switchLabel","formatDate","startOfWeek","getWeek","addWeeks","classList","current","addDays","date","day","pushUnique","rangeStart","rangeEnd"],"mappings":"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"}