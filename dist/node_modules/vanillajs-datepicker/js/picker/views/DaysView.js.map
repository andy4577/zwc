{"version":3,"file":"DaysView.js","sources":["../../../../../../../../node_modules/vanillajs-datepicker/js/picker/views/DaysView.js"],"sourcesContent":["import {hasProperty, pushUnique} from '../../lib/utils.js';\nimport {today, dateValue, addDays, addWeeks, dayOfTheWeekOf, getWeek} from '../../lib/date.js';\nimport {formatDate} from '../../lib/date-format.js';\nimport {parseHTML, showElement, hideElement} from '../../lib/dom.js';\nimport daysTemplate from '../templates/daysTemplate.js';\nimport calendarWeeksTemplate from '../templates/calendarWeeksTemplate.js';\nimport View from './View.js';\n\nexport default class DaysView extends View {\n  constructor(picker) {\n    super(picker, {\n      id: 0,\n      name: 'days',\n      cellClass: 'day',\n    });\n  }\n\n  init(options, onConstruction = true) {\n    if (onConstruction) {\n      const inner = parseHTML(daysTemplate).firstChild;\n      this.dow = inner.firstChild;\n      this.grid = inner.lastChild;\n      this.element.appendChild(inner);\n    }\n    super.init(options);\n  }\n\n  setOptions(options) {\n    let updateDOW;\n\n    if (hasProperty(options, 'minDate')) {\n      this.minDate = options.minDate;\n    }\n    if (hasProperty(options, 'maxDate')) {\n      this.maxDate = options.maxDate;\n    }\n    if (options.datesDisabled) {\n      this.datesDisabled = options.datesDisabled;\n    }\n    if (options.daysOfWeekDisabled) {\n      this.daysOfWeekDisabled = options.daysOfWeekDisabled;\n      updateDOW = true;\n    }\n    if (options.daysOfWeekHighlighted) {\n      this.daysOfWeekHighlighted = options.daysOfWeekHighlighted;\n    }\n    if (options.todayHighlight !== undefined) {\n      this.todayHighlight = options.todayHighlight;\n    }\n    if (options.weekStart !== undefined) {\n      this.weekStart = options.weekStart;\n      this.weekEnd = options.weekEnd;\n      updateDOW = true;\n    }\n    if (options.locale) {\n      const locale = this.locale = options.locale;\n      this.dayNames = locale.daysMin;\n      this.switchLabelFormat = locale.titleFormat;\n      updateDOW = true;\n    }\n    if (options.beforeShowDay !== undefined) {\n      this.beforeShow = typeof options.beforeShowDay === 'function'\n        ? options.beforeShowDay\n        : undefined;\n    }\n\n    if (options.calendarWeeks !== undefined) {\n      if (options.calendarWeeks && !this.calendarWeeks) {\n        const weeksElem = parseHTML(calendarWeeksTemplate).firstChild;\n        this.calendarWeeks = {\n          element: weeksElem,\n          dow: weeksElem.firstChild,\n          weeks: weeksElem.lastChild,\n        };\n        this.element.insertBefore(weeksElem, this.element.firstChild);\n      } else if (this.calendarWeeks && !options.calendarWeeks) {\n        this.element.removeChild(this.calendarWeeks.element);\n        this.calendarWeeks = null;\n      }\n    }\n    if (options.showDaysOfWeek !== undefined) {\n      if (options.showDaysOfWeek) {\n        showElement(this.dow);\n        if (this.calendarWeeks) {\n          showElement(this.calendarWeeks.dow);\n        }\n      } else {\n        hideElement(this.dow);\n        if (this.calendarWeeks) {\n          hideElement(this.calendarWeeks.dow);\n        }\n      }\n    }\n\n    // update days-of-week when locale, daysOfweekDisabled or weekStart is changed\n    if (updateDOW) {\n      Array.from(this.dow.children).forEach((el, index) => {\n        const dow = (this.weekStart + index) % 7;\n        el.textContent = this.dayNames[dow];\n        el.className = this.daysOfWeekDisabled.includes(dow) ? 'dow disabled' : 'dow';\n      });\n    }\n  }\n\n  // Apply update on the focused date to view's settings\n  updateFocus() {\n    const viewDate = new Date(this.picker.viewDate);\n    const viewYear = viewDate.getFullYear();\n    const viewMonth = viewDate.getMonth();\n    const firstOfMonth = dateValue(viewYear, viewMonth, 1);\n    const start = dayOfTheWeekOf(firstOfMonth, this.weekStart, this.weekStart);\n\n    this.first = firstOfMonth;\n    this.last = dateValue(viewYear, viewMonth + 1, 0);\n    this.start = start;\n    this.focused = this.picker.viewDate;\n  }\n\n  // Apply update on the selected dates to view's settings\n  updateSelection() {\n    const {dates, rangepicker} = this.picker.datepicker;\n    this.selected = dates;\n    if (rangepicker) {\n      this.range = rangepicker.dates;\n    }\n  }\n\n   // Update the entire view UI\n  render() {\n    // update today marker on ever render\n    this.today = this.todayHighlight ? today() : undefined;\n    // refresh disabled dates on every render in order to clear the ones added\n    // by beforeShow hook at previous render\n    this.disabled = [...this.datesDisabled];\n\n    const switchLabel = formatDate(this.focused, this.switchLabelFormat, this.locale);\n    this.picker.setViewSwitchLabel(switchLabel);\n    this.picker.setPrevBtnDisabled(this.first <= this.minDate);\n    this.picker.setNextBtnDisabled(this.last >= this.maxDate);\n\n    if (this.calendarWeeks) {\n      // start of the UTC week (Monday) of the 1st of the month\n      const startOfWeek = dayOfTheWeekOf(this.first, 1, 1);\n      Array.from(this.calendarWeeks.weeks.children).forEach((el, index) => {\n        el.textContent = getWeek(addWeeks(startOfWeek, index));\n      });\n    }\n    Array.from(this.grid.children).forEach((el, index) => {\n      const classList = el.classList;\n      const current = addDays(this.start, index);\n      const date = new Date(current);\n      const day = date.getDay();\n\n      el.className = `datepicker-cell ${this.cellClass}`;\n      el.dataset.date = current;\n      el.textContent = date.getDate();\n\n      if (current < this.first) {\n        classList.add('prev');\n      } else if (current > this.last) {\n        classList.add('next');\n      }\n      if (this.today === current) {\n        classList.add('today');\n      }\n      if (current < this.minDate || current > this.maxDate || this.disabled.includes(current)) {\n        classList.add('disabled');\n      }\n      if (this.daysOfWeekDisabled.includes(day)) {\n        classList.add('disabled');\n        pushUnique(this.disabled, current);\n      }\n      if (this.daysOfWeekHighlighted.includes(day)) {\n        classList.add('highlighted');\n      }\n      if (this.range) {\n        const [rangeStart, rangeEnd] = this.range;\n        if (current > rangeStart && current < rangeEnd) {\n          classList.add('range');\n        }\n        if (current === rangeStart) {\n          classList.add('range-start');\n        }\n        if (current === rangeEnd) {\n          classList.add('range-end');\n        }\n      }\n      if (this.selected.includes(current)) {\n        classList.add('selected');\n      }\n      if (current === this.focused) {\n        classList.add('focused');\n      }\n\n      if (this.beforeShow) {\n        this.performBeforeHook(el, current, current);\n      }\n    });\n  }\n\n  // Update the view UI by applying the changes of selected and focused items\n  refresh() {\n    const [rangeStart, rangeEnd] = this.range || [];\n    this.grid\n      .querySelectorAll('.range, .range-start, .range-end, .selected, .focused')\n      .forEach((el) => {\n        el.classList.remove('range', 'range-start', 'range-end', 'selected', 'focused');\n      });\n    Array.from(this.grid.children).forEach((el) => {\n      const current = Number(el.dataset.date);\n      const classList = el.classList;\n      if (current > rangeStart && current < rangeEnd) {\n        classList.add('range');\n      }\n      if (current === rangeStart) {\n        classList.add('range-start');\n      }\n      if (current === rangeEnd) {\n        classList.add('range-end');\n      }\n      if (this.selected.includes(current)) {\n        classList.add('selected');\n      }\n      if (current === this.focused) {\n        classList.add('focused');\n      }\n    });\n  }\n\n  // Update the view UI by applying the change of focused item\n  refreshFocus() {\n    const index = Math.round((this.focused - this.start) / 86400000);\n    this.grid.querySelectorAll('.focused').forEach((el) => {\n      el.classList.remove('focused');\n    });\n    this.grid.children[index].classList.add('focused');\n  }\n}\n"],"names":["DaysView","View","picker","options","onConstruction","inner","parseHTML","daysTemplate","updateDOW","hasProperty","locale","weeksElem","calendarWeeksTemplate","showElement","hideElement","el","index","dow","viewDate","viewYear","viewMonth","firstOfMonth","dateValue","start","dayOfTheWeekOf","dates","rangepicker","today","switchLabel","formatDate","startOfWeek","getWeek","addWeeks","classList","current","addDays","date","day","pushUnique","rangeStart","rangeEnd"],"mappings":"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"}