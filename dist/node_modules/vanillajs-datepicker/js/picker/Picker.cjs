"use strict";const p=require("../lib/utils.cjs"),k=require("../lib/date.cjs"),o=require("../lib/dom.cjs"),Y=require("../lib/event.cjs"),N=require("./templates/pickerTemplate.cjs"),_=require("./views/DaysView.cjs"),H=require("./views/MonthsView.cjs"),R=require("./views/YearsView.cjs"),B=require("../events/functions.cjs"),f=require("../events/pickerListeners.cjs"),P=["left","top","right","bottom"].reduce((i,e)=>(i[e]=`datepicker-orient-${e}`,i),{}),q=i=>i&&`${i}px`;function F(i,e){if(e.title!==void 0&&(e.title?(i.controls.title.textContent=e.title,o.showElement(i.controls.title)):(i.controls.title.textContent="",o.hideElement(i.controls.title))),e.prevArrow){const t=i.controls.prevBtn;o.emptyChildNodes(t),e.prevArrow.forEach(n=>{t.appendChild(n.cloneNode(!0))})}if(e.nextArrow){const t=i.controls.nextBtn;o.emptyChildNodes(t),e.nextArrow.forEach(n=>{t.appendChild(n.cloneNode(!0))})}if(e.locale&&(i.controls.todayBtn.textContent=e.locale.today,i.controls.clearBtn.textContent=e.locale.clear),e.todayBtn!==void 0&&(e.todayBtn?o.showElement(i.controls.todayBtn):o.hideElement(i.controls.todayBtn)),p.hasProperty(e,"minDate")||p.hasProperty(e,"maxDate")){const{minDate:t,maxDate:n}=i.datepicker.config;i.controls.todayBtn.disabled=!p.isInRange(k.today(),t,n)}e.clearBtn!==void 0&&(e.clearBtn?o.showElement(i.controls.clearBtn):o.hideElement(i.controls.clearBtn))}function T(i){const{dates:e,config:t}=i,n=e.length>0?p.lastItemOf(e):t.defaultViewDate;return p.limitToRange(n,t.minDate,t.maxDate)}function A(i,e){const t=new Date(i.viewDate),n=new Date(e),{id:h,year:a,first:c,last:d}=i.currentView,r=n.getFullYear();switch(i.viewDate=e,r!==t.getFullYear()&&B.triggerDatepickerEvent(i.datepicker,"changeYear"),n.getMonth()!==t.getMonth()&&B.triggerDatepickerEvent(i.datepicker,"changeMonth"),h){case 0:return e<c||e>d;case 1:return r!==a;default:return r<c||r>d}}function M(i){return window.getComputedStyle(i).direction}function S(i){const e=o.getParent(i);if(!(e===document.body||!e))return window.getComputedStyle(e).overflow!=="visible"?e:S(e)}class O{constructor(e){const{config:t}=this.datepicker=e,n=N.replace(/%buttonClass%/g,t.buttonClass),h=this.element=o.parseHTML(n).firstChild,[a,c,d]=h.firstChild.children,r=a.firstElementChild,[C,w,y]=a.lastElementChild.children,[V,D]=d.firstChild.children,s={title:r,prevBtn:C,viewSwitch:w,nextBtn:y,todayBtn:V,clearBtn:D};this.main=c,this.controls=s;const u=e.inline?"inline":"dropdown";h.classList.add(`datepicker-${u}`),F(this,t),this.viewDate=T(e),Y.registerListeners(e,[[h,"mousedown",f.onMousedownPicker],[c,"click",f.onClickView.bind(null,e)],[s.viewSwitch,"click",f.onClickViewSwitch.bind(null,e)],[s.prevBtn,"click",f.onClickPrevBtn.bind(null,e)],[s.nextBtn,"click",f.onClickNextBtn.bind(null,e)],[s.todayBtn,"click",f.onClickTodayBtn.bind(null,e)],[s.clearBtn,"click",f.onClickClearBtn.bind(null,e)]]),this.views=[new _(this),new H(this),new R(this,{id:2,name:"years",cellClass:"year",step:1}),new R(this,{id:3,name:"decades",cellClass:"decade",step:10})],this.currentView=this.views[t.startView],this.currentView.render(),this.main.appendChild(this.currentView.element),t.container?t.container.appendChild(this.element):e.inputField.after(this.element)}setOptions(e){F(this,e),this.views.forEach(t=>{t.init(e,!1)}),this.currentView.render()}detach(){this.element.remove()}show(){if(this.active)return;const{datepicker:e,element:t}=this;if(e.inline)t.classList.add("active");else{const n=M(e.inputField);n!==M(o.getParent(t))?t.dir=n:t.dir&&t.removeAttribute("dir"),t.style.visiblity="hidden",t.classList.add("active"),this.place(),t.style.visiblity="",e.config.disableTouchKeyboard&&e.inputField.blur()}this.active=!0,B.triggerDatepickerEvent(e,"show")}hide(){!this.active||(this.datepicker.exitEditMode(),this.element.classList.remove("active"),this.active=!1,B.triggerDatepickerEvent(this.datepicker,"hide"))}place(){const{classList:e,offsetParent:t,style:n}=this.element,{config:h,inputField:a}=this.datepicker,{width:c,height:d}=this.element.getBoundingClientRect(),{left:r,top:C,right:w,bottom:y,width:V,height:D}=a.getBoundingClientRect();let{x:s,y:u}=h.orientation,m=r,g=C;if(t===document.body||!t)m+=window.scrollX,g+=window.scrollY;else{const l=t.getBoundingClientRect();m-=l.left-t.scrollLeft,g-=l.top-t.scrollTop}const L=S(a);let b=0,j=0,{clientWidth:v,clientHeight:x}=document.documentElement;if(L){const l=L.getBoundingClientRect();l.top>0&&(j=l.top),l.left>0&&(b=l.left),l.right<v&&(v=l.right),l.bottom<x&&(x=l.bottom)}let E=0;s==="auto"&&(r<b?(s="left",E=b-r):r+c>v?(s="right",v<w&&(E=v-w)):M(a)==="rtl"?s=w-c<b?"left":"right":s="left"),s==="right"&&(m+=V-c),m+=E,u==="auto"&&(C-d>j?u=y+d>x?"top":"bottom":u="bottom"),u==="top"?g-=d:g+=D,e.remove(...Object.values(P)),e.add(P[s],P[u]),n.left=q(m),n.top=q(g)}setViewSwitchLabel(e){this.controls.viewSwitch.textContent=e}setPrevBtnDisabled(e){this.controls.prevBtn.disabled=e}setNextBtnDisabled(e){this.controls.nextBtn.disabled=e}changeView(e){const t=this.currentView,n=this.views[e];return n.id!==t.id&&(this.currentView=n,this._renderMethod="render",B.triggerDatepickerEvent(this.datepicker,"changeView"),this.main.replaceChild(n.element,t.element)),this}changeFocus(e){return this._renderMethod=A(this,e)?"render":"refreshFocus",this.views.forEach(t=>{t.updateFocus()}),this}update(){const e=T(this.datepicker);return this._renderMethod=A(this,e)?"render":"refresh",this.views.forEach(t=>{t.updateFocus(),t.updateSelection()}),this}render(e=!0){const t=e&&this._renderMethod||"render";delete this._renderMethod,this.currentView[t]()}}module.exports=O;
//# sourceMappingURL=Picker.cjs.map
